name: 포트폴리오 자동 업데이트

permissions:
  contents: write
  pages: write
  id-token: write
  
on:
  push:
    branches: [ main ]
    paths: 
      - 'data/projects.json'  # 이 파일이 변경될 때만 실행
      - 'templates/**'        # 템플릿 변경 시에도 실행
  workflow_dispatch:          # 수동 실행도 가능

jobs:
  update-portfolio:
    runs-on: ubuntu-latest
    
    steps:
    - name: 코드 체크아웃
      uses: actions/checkout@v3
      
    - name: Node.js 설정
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: 포트폴리오 생성
      run: node scripts/generate.js
      
    - name: 변경사항 커밋
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add src/index.html
        git diff --staged --quiet || git commit -m "🚀 포트폴리오 자동 업데이트"
        git push
        
    - name: GitHub Pages 배포
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./src
        
    - name: 완료 알림
      run: |
        echo "🎉 포트폴리오가 성공적으로 업데이트되었습니다!"
        echo "📍 확인하기: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
