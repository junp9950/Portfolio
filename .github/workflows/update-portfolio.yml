name: ν¬νΈν΄λ¦¬μ¤ μλ™ μ—…λ°μ΄νΈ

permissions:
  contents: write
  pages: write
  id-token: write
  
on:
  push:
    branches: [ main ]
    paths: 
      - 'data/projects.json'  # μ΄ νμΌμ΄ λ³€κ²½λ  λ•λ§ μ‹¤ν–‰
      - 'templates/**'        # ν…ν”λ¦Ώ λ³€κ²½ μ‹μ—λ„ μ‹¤ν–‰
  workflow_dispatch:          # μλ™ μ‹¤ν–‰λ„ κ°€λ¥

jobs:
  update-portfolio:
    runs-on: ubuntu-latest
    
    steps:
    - name: μ½”λ“ μ²΄ν¬μ•„μ›ƒ
      uses: actions/checkout@v3
      
    - name: Node.js μ„¤μ •
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: ν¬νΈν΄λ¦¬μ¤ μƒμ„±
      run: node scripts/generate.js
      
    - name: λ³€κ²½μ‚¬ν•­ μ»¤λ°‹
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add src/index.html
        git diff --staged --quiet || git commit -m "π€ ν¬νΈν΄λ¦¬μ¤ μλ™ μ—…λ°μ΄νΈ"
        git push
        
    - name: GitHub Pages λ°°ν¬
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./src
        
    - name: μ™„λ£ μ•λ¦Ό
      run: |
        echo "π‰ ν¬νΈν΄λ¦¬μ¤κ°€ μ„±κ³µμ μΌλ΅ μ—…λ°μ΄νΈλμ—μµλ‹λ‹¤!"
        echo "π“ ν™•μΈν•κΈ°: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
